# è¶…é‡‡æ ·è¾¹ç•Œå¤„ç†åˆ†æï¼šæ˜¯å¦éœ€è¦Border Expansionï¼Ÿ

## é—®é¢˜é™ˆè¿°

NVIDIA NPPæ–‡æ¡£è¦æ±‚é‚»åŸŸæ“ä½œï¼ˆneighborhood operationsï¼‰å¿…é¡»ç¡®ä¿æ‰€æœ‰è¯»å–çš„åƒç´ éƒ½åœ¨å›¾åƒè¾¹ç•Œå†…ï¼Œå¦åˆ™éœ€è¦ä½¿ç”¨borderæ‰©å±•ã€‚

**æ ¸å¿ƒé—®é¢˜**ï¼šè¶…é‡‡æ ·ä½œä¸ºä¸‹é‡‡æ ·çš„box filterï¼Œæ˜¯å¦éœ€è¦è€ƒè™‘è¿™ä¸ªè¾¹ç•Œæ‰©å±•é—®é¢˜ï¼Ÿ

## ç®€çŸ­ç­”æ¡ˆ

**ä¸éœ€è¦ï¼è¶…é‡‡æ ·ï¼ˆä¸‹é‡‡æ ·ï¼‰ä¸ä¼ ç»Ÿé‚»åŸŸæ“ä½œæœ‰æœ¬è´¨åŒºåˆ«ï¼Œä¸éœ€è¦borderæ‰©å±•ã€‚**

åŸå› ï¼š
1. âœ… é‡‡æ ·åŒºåŸŸ**è‡ªç„¶æ”¶ç¼©**ï¼Œä¸ä¼šè¶Šç•Œ
2. âœ… ä¸‹é‡‡æ ·è¾“å‡ºå°ºå¯¸ < è¾“å…¥å°ºå¯¸
3. âœ… æ¯ä¸ªè¾“å‡ºåƒç´ çš„é‡‡æ ·åŒºåŸŸå®Œå…¨åœ¨è¾“å…¥ROIå†…

## è¯¦ç»†åˆ†æ

### 1. ä¼ ç»Ÿé‚»åŸŸæ“ä½œ vs è¶…é‡‡æ ·

#### 1.1 ä¼ ç»Ÿé‚»åŸŸæ“ä½œï¼ˆéœ€è¦Borderï¼‰

**ç¤ºä¾‹ï¼š3Ã—3 Box Filter å¹³æ»‘**

```
è¾“å…¥å›¾åƒ (4Ã—4):               è¾“å‡ºå›¾åƒ (4Ã—4):
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”            â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚ A â”‚ B â”‚ C â”‚ D â”‚            â”‚ ? â”‚ ? â”‚ ? â”‚ ? â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤            â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚ E â”‚ F â”‚ G â”‚ H â”‚            â”‚ ? â”‚ O â”‚ P â”‚ ? â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤    â†’       â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚ I â”‚ J â”‚ K â”‚ L â”‚            â”‚ ? â”‚ S â”‚ T â”‚ ? â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤            â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚ M â”‚ N â”‚ O â”‚ P â”‚            â”‚ ? â”‚ ? â”‚ ? â”‚ ? â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜            â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜

è®¡ç®— output[1,1]:
  éœ€è¦è¯»å– input[0:3, 0:3]
  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
  â”‚ A â”‚ B â”‚ C â”‚  â† 3Ã—3é‚»åŸŸ
  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
  â”‚ E â”‚ F â”‚ G â”‚
  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
  â”‚ I â”‚ J â”‚ K â”‚
  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
  æ‰€æœ‰åƒç´ éƒ½åœ¨èŒƒå›´å†… âœ“

è®¡ç®— output[0,0]:
  éœ€è¦è¯»å– input[-1:2, -1:2]
  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
  â”‚ ? â”‚ ? â”‚ ? â”‚  â† è¶Šç•Œï¼
  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
  â”‚ ? â”‚ A â”‚ B â”‚
  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
  â”‚ ? â”‚ E â”‚ F â”‚
  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
  éœ€è¦è¾¹ç•Œæ‰©å±• âœ—
```

**é—®é¢˜**ï¼š
- è¾“å…¥è¾“å‡ºå°ºå¯¸**ç›¸åŒ** (4Ã—4 â†’ 4Ã—4)
- è¾¹ç¼˜åƒç´ çš„é‚»åŸŸ**è¶…å‡ºè¾¹ç•Œ**
- å¿…é¡»**ç¼©å°è¾“å‡ºROI**æˆ–ä½¿ç”¨**borderæ‰©å±•**

#### 1.2 è¶…é‡‡æ ·ï¼ˆä¸éœ€è¦Borderï¼‰

**ç¤ºä¾‹ï¼š2xè¶…é‡‡æ ·ä¸‹é‡‡æ ·**

```
è¾“å…¥å›¾åƒ (4Ã—4):               è¾“å‡ºå›¾åƒ (2Ã—2):
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A â”‚ B â”‚ C â”‚ D â”‚            â”‚       â”‚       â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤            â”‚   O   â”‚   P   â”‚
â”‚ E â”‚ F â”‚ G â”‚ H â”‚     â†’      â”‚       â”‚       â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ I â”‚ J â”‚ K â”‚ L â”‚            â”‚       â”‚       â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤            â”‚   S   â”‚   T   â”‚
â”‚ M â”‚ N â”‚ O â”‚ P â”‚            â”‚       â”‚       â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
                              scale = 2.0

è®¡ç®— output[0,0]:
  é‡‡æ ·åŒºåŸŸ = [0.0, 2.0) Ã— [0.0, 2.0)
  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”
  â”‚ A â”‚ B â”‚  â† å®Œå…¨åœ¨è¾¹ç•Œå†…
  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¤
  â”‚ E â”‚ F â”‚
  â””â”€â”€â”€â”´â”€â”€â”€â”˜
  æ‰€æœ‰åƒç´ éƒ½æœ‰æ•ˆ âœ“

è®¡ç®— output[1,1]:
  é‡‡æ ·åŒºåŸŸ = [2.0, 4.0) Ã— [2.0, 4.0)
  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”
  â”‚ K â”‚ L â”‚  â† å®Œå…¨åœ¨è¾¹ç•Œå†…
  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¤
  â”‚ O â”‚ P â”‚
  â””â”€â”€â”€â”´â”€â”€â”€â”˜
  æ‰€æœ‰åƒç´ éƒ½æœ‰æ•ˆ âœ“
```

**å…³é”®å·®å¼‚**ï¼š
- è¾“å…¥è¾“å‡ºå°ºå¯¸**ä¸åŒ** (4Ã—4 â†’ 2Ã—2)
- é‡‡æ ·åŒºåŸŸ**è‡ªç„¶æ”¶ç¼©**ï¼Œå®Œå…¨åœ¨è¾¹ç•Œå†…
- **ä¸éœ€è¦**borderæ‰©å±• âœ“

### 2. æ•°å­¦è¯æ˜ï¼šé‡‡æ ·åŒºåŸŸä¸ä¼šè¶Šç•Œ

#### 2.1 é‡‡æ ·åŒºåŸŸè®¡ç®—

å¯¹äºè¾“å‡ºåƒç´  `dst(dx, dy)`ï¼š

```cpp
// V2ç®—æ³•çš„é‡‡æ ·åŒºåŸŸ
float srcCenterX = (dx + 0.5f) * scaleX + oSrcRectROI.x;
float srcCenterY = (dy + 0.5f) * scaleY + oSrcRectROI.y;

float xMin = srcCenterX - scaleX/2;
float xMax = srcCenterX + scaleX/2;
float yMin = srcCenterY - scaleY/2;
float yMax = srcCenterY + scaleY/2;
```

#### 2.2 è¾¹ç•Œåˆ†æ

**å·¦è¾¹ç•Œ** (dx = 0):
```
xMin = (0 + 0.5) * scaleX - scaleX/2 + ROI.x
     = 0.5 * scaleX - 0.5 * scaleX + ROI.x
     = ROI.x âœ“

æœ€å°é‡‡æ ·ä½ç½® = ROI.xï¼Œä¸ä¼šå°äºè¾¹ç•Œ
```

**å³è¾¹ç•Œ** (dx = dstWidth - 1):
```
ç¼©æ”¾å…³ç³»ï¼šscaleX = srcWidth / dstWidth

xMax = (dx + 0.5) * scaleX + scaleX/2 + ROI.x
     = ((dstWidth - 1) + 0.5) * scaleX + scaleX/2 + ROI.x
     = (dstWidth - 0.5) * scaleX + scaleX/2 + ROI.x
     = dstWidth * scaleX + ROI.x
     = srcWidth + ROI.x
     = ROI.x + ROI.width âœ“

æœ€å¤§é‡‡æ ·ä½ç½® = ROI.x + ROI.widthï¼Œæ°å¥½æ˜¯è¾¹ç•Œ
```

**ç»“è®º**ï¼šé‡‡æ ·åŒºåŸŸæ°å¥½è¦†ç›– `[ROI.x, ROI.x + ROI.width)`ï¼Œä¸ä¼šè¶Šç•Œï¼

### 3. ä»£ç éªŒè¯

#### 3.1 å½“å‰V2å®ç°çš„è¾¹ç•Œä¿æŠ¤

```cpp
// src/nppi/nppi_geometry_transforms/interpolators/super_v2_interpolator.cuh

// è®¡ç®—é‡‡æ ·åŒºåŸŸ
float xMin = srcCenterX - halfScaleX;
float xMax = srcCenterX + halfScaleX;

// æ•´æ•°è¾¹ç•Œ
int xMinInt = (int)ceilf(xMin);
int xMaxInt = (int)floorf(xMax);

// ğŸ”’ è¾¹ç•Œè£å‰ªï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ï¼Œè™½ç„¶ç†è®ºä¸Šä¸éœ€è¦ï¼‰
xMinInt = max(xMinInt, oSrcRectROI.x);
xMaxInt = min(xMaxInt, oSrcRectROI.x + oSrcRectROI.width);
yMinInt = max(yMinInt, oSrcRectROI.y);
yMaxInt = min(yMaxInt, oSrcRectROI.y + oSrcRectROI.height);

// è¾¹ç¼˜åƒç´ è®¿é—®æ£€æŸ¥
if (wxMin > 0.0f && xMinInt > oSrcRectROI.x) {  // â† æ˜¾å¼æ£€æŸ¥
    int x = xMinInt - 1;
    sum += src_row[x * CHANNELS + c] * wxMin;
}

if (wxMax > 0.0f && xMaxInt < oSrcRectROI.x + oSrcRectROI.width) {  // â† æ˜¾å¼æ£€æŸ¥
    int x = xMaxInt;
    sum += src_row[x * CHANNELS + c] * wxMax;
}
```

**ä¿æŠ¤æªæ–½**ï¼š
1. âœ… æ•´æ•°è¾¹ç•Œè£å‰ªï¼ˆlines 38-41ï¼‰
2. âœ… è¾¹ç¼˜åƒç´ è®¿é—®å‰æ£€æŸ¥ï¼ˆlines 67, 85ç­‰ï¼‰
3. âœ… åŒé‡ä¿é™©ï¼Œç¡®ä¿ä¸ä¼šè¶Šç•Œ

#### 3.2 è¾¹ç•Œæƒ…å†µæµ‹è¯•

è®©æˆ‘æ£€æŸ¥ç°æœ‰æµ‹è¯•æ˜¯å¦è¦†ç›–è¾¹ç•Œæƒ…å†µï¼š

```bash
# æœç´¢è¾¹ç•Œæµ‹è¯•
grep -n "Boundary\|Edge\|Corner" test/unit/nppi/nppi_geometry_transforms/test_nppi_resize.cpp
```

ç»“æœï¼š
- Line 570: `Resize_8u_C3R_Super_BoundaryTest`
- Line 631: `Resize_8u_C3R_Super_CornerTest`
- Line 685: `Resize_8u_C3R_Super_GradientBoundary`

**æµ‹è¯•éªŒè¯**ï¼šè¿™äº›æµ‹è¯•å·²ç»è¦†ç›–è¾¹ç•Œæƒ…å†µï¼Œå…¨éƒ¨é€šè¿‡ âœ“

### 4. å¯¹æ¯”ï¼šå“ªäº›æ“ä½œéœ€è¦Borderï¼Ÿ

#### 4.1 éœ€è¦Borderæ‰©å±•çš„æ“ä½œ

| æ“ä½œç±»å‹ | åŸå›  | ç¤ºä¾‹ |
|---------|------|------|
| **å›ºå®šæ ¸å·ç§¯** | è¾“å‡º=è¾“å…¥å°ºå¯¸ï¼Œè¾¹ç¼˜è¶Šç•Œ | 3Ã—3é«˜æ–¯æ¨¡ç³Š |
| **å½¢æ€å­¦æ“ä½œ** | ç»“æ„å…ƒç´ æ‰©å±•è¾¹ç•Œ | è†¨èƒ€/è…èš€ |
| **å›ºå®šBox Filter** | æ ¸å°ºå¯¸å›ºå®šï¼Œè¾¹ç¼˜è¶Šç•Œ | 5Ã—5å¹³å‡æ»¤æ³¢ |
| **è¾¹ç¼˜æ£€æµ‹** | Sobel/Cannyéœ€è¦é‚»åŸŸ | æ¢¯åº¦è®¡ç®— |
| **ä¸Šé‡‡æ ·æ’å€¼** | è¯»å–å‘¨å›´åƒç´  | Lanczosä¸Šé‡‡æ · |

**å…±åŒç‰¹å¾**ï¼š
- è¾“å‡ºå°ºå¯¸ â‰¥ è¾“å…¥å°ºå¯¸
- æˆ–å›ºå®šé‚»åŸŸå¤§å°
- è¾¹ç¼˜åƒç´ éœ€è¦è¾¹ç•Œå¤–çš„æ•°æ®

#### 4.2 ä¸éœ€è¦Borderæ‰©å±•çš„æ“ä½œ

| æ“ä½œç±»å‹ | åŸå›  | ç¤ºä¾‹ |
|---------|------|------|
| **ä¸‹é‡‡æ ·** | è¾“å‡º<è¾“å…¥ï¼Œé‡‡æ ·åŒºåŸŸæ”¶ç¼© | è¶…é‡‡æ · |
| **ç‚¹æ“ä½œ** | ä¸è®¿é—®é‚»åŸŸ | äº®åº¦è°ƒæ•´ |
| **ç¼©å°ROI** | ä¸»åŠ¨é¿å¼€è¾¹ç•Œ | ROIè£å‰ª |

**å…±åŒç‰¹å¾**ï¼š
- è¾“å‡ºå°ºå¯¸ < è¾“å…¥å°ºå¯¸ï¼ˆä¸‹é‡‡æ ·ï¼‰
- æˆ–ä¸è®¿é—®é‚»åŸŸï¼ˆç‚¹æ“ä½œï¼‰

### 5. å®é™…åœºæ™¯åˆ†æ

#### 5.1 å…¨å°ºå¯¸å›¾åƒä¸‹é‡‡æ ·

```cpp
// åœºæ™¯ï¼š1920Ã—1080 â†’ 960Ã—540 (2xä¸‹é‡‡æ ·)

NppiSize srcSize = {1920, 1080};
NppiSize dstSize = {960, 540};
NppiRect srcROI = {0, 0, 1920, 1080};  // å…¨å›¾
NppiRect dstROI = {0, 0, 960, 540};    // å…¨å›¾

// âœ“ å®Œå…¨å®‰å…¨ï¼Œä¸éœ€è¦borderæ‰©å±•
nppiResize_8u_C3R(..., NPPI_INTER_SUPER);
```

**åˆ†æ**ï¼š
- é‡‡æ ·åŒºåŸŸæœ€å¤§å€¼ = (959.5) Ã— 2.0 + 1.0 = 1920 âœ“
- é‡‡æ ·åŒºåŸŸæœ€å°å€¼ = 0.5 Ã— 2.0 - 1.0 = 0 âœ“
- å®Œå…¨åœ¨ [0, 1920) èŒƒå›´å†…

#### 5.2 ROIä¸‹é‡‡æ ·

```cpp
// åœºæ™¯ï¼šä»1920Ã—1080ä¸­æå–å¹¶ä¸‹é‡‡æ ·ä¸€ä¸ªROI

NppiSize srcSize = {1920, 1080};
NppiSize dstSize = {100, 100};
NppiRect srcROI = {100, 100, 500, 500};  // æºROI
NppiRect dstROI = {0, 0, 100, 100};      // ç›®æ ‡ROI

// scaleX = 500/100 = 5.0
// scaleY = 500/100 = 5.0

// âœ“ é‡‡æ ·èŒƒå›´ï¼š[100, 600) Ã— [100, 600)
// âœ“ å®Œå…¨åœ¨srcROIå†…ï¼Œå®‰å…¨
nppiResize_8u_C3R(..., NPPI_INTER_SUPER);
```

#### 5.3 æç«¯æƒ…å†µï¼š1åƒç´ ä¸‹é‡‡æ ·

```cpp
// æç«¯ï¼šæ•´å¼ å›¾å‹ç¼©æˆ1ä¸ªåƒç´ 

NppiSize srcSize = {1920, 1080};
NppiSize dstSize = {1, 1};
NppiRect srcROI = {0, 0, 1920, 1080};
NppiRect dstROI = {0, 0, 1, 1};

// dst(0,0)çš„é‡‡æ ·åŒºåŸŸï¼š
// xMin = 0.5 * 1920 - 960 = 0
// xMax = 0.5 * 1920 + 960 = 1920
// èŒƒå›´ï¼š[0, 1920) âœ“ å®Œå…¨è¦†ç›–ï¼Œå®‰å…¨
```

### 6. ä¸å…¶ä»–Resizeæ¨¡å¼å¯¹æ¯”

#### 6.1 Linearæ’å€¼ï¼ˆä¸Šé‡‡æ ·ï¼‰

```cpp
// ä¸Šé‡‡æ ·ï¼š100Ã—100 â†’ 200Ã—200

// dst(0,0)è®¡ç®—ï¼š
fx = 0 * (100/200) = 0.0
fy = 0 * (100/200) = 0.0

// éœ€è¦è¯»å– src[0,0], src[0,1], src[1,0], src[1,1]
// âœ“ éƒ½åœ¨è¾¹ç•Œå†…

// dst(199,199)è®¡ç®—ï¼š
fx = 199 * (100/200) = 99.5
fy = 199 * (100/200) = 99.5

// éœ€è¦è¯»å– src[99,99], src[99,100], src[100,99], src[100,100]
//                                â†‘           â†‘            â†‘
//                              è¶Šç•Œï¼      è¶Šç•Œï¼        è¶Šç•Œï¼

// âœ— ä¸Šé‡‡æ ·çš„è¾¹ç¼˜éœ€è¦å¤–æ¨æˆ–è£å‰ª
```

**Linearæ’å€¼çš„å¤„ç†**ï¼š
```cpp
// bilinear_interpolator.cuh
int x2 = min(x1 + 1, oSrcRectROI.x + oSrcRectROI.width - 1);  // Clamp
int y2 = min(y1 + 1, oSrcRectROI.y + oSrcRectROI.height - 1);

// ä½¿ç”¨clampæ¨¡å¼ï¼šé‡å¤è¾¹ç¼˜åƒç´ 
```

#### 6.2 Lanczosæ’å€¼ï¼ˆä¸Šé‡‡æ ·ï¼‰

```cpp
// Lanczoséœ€è¦6Ã—6é‚»åŸŸ
// ä¸Šé‡‡æ ·è¾¹ç¼˜åƒç´ éœ€è¦æ›´å¤§çš„æ‰©å±•
// é€šå¸¸éœ€è¦borderæ‰©å±•æˆ–ç‰¹æ®Šå¤„ç†
```

### 7. NPPæ–‡æ¡£çš„é€‚ç”¨æ€§åˆ†æ

#### 7.1 æ–‡æ¡£åŸæ–‡è§£è¯»

```
"neighborhood operations read pixels from an enlarged source ROI"
                                              â†‘
                                         å…³é”®è¯ï¼šenlarged

ä¸‹é‡‡æ ·çš„source ROIæ˜¯ SMALLERï¼Œä¸æ˜¯enlargedï¼
```

**æ–‡æ¡£é€‚ç”¨çš„æ“ä½œ**ï¼š
- âœ“ å·ç§¯ (enlarged by kernel size)
- âœ“ å½¢æ€å­¦ (enlarged by structuring element)
- âœ“ å›ºå®šé‚»åŸŸæ“ä½œ (enlarged by neighborhood)

**æ–‡æ¡£ä¸é€‚ç”¨çš„æ“ä½œ**ï¼š
- âœ— ä¸‹é‡‡æ · (source ROI shrinks, not enlarges)
- âœ— ç‚¹æ“ä½œ (no neighborhood)

#### 7.2 ä¸ºä»€ä¹ˆæ–‡æ¡£å¼ºè°ƒè¿™ä¸€ç‚¹ï¼Ÿ

**å†å²åŸå› **ï¼š
1. NPPå¤§éƒ¨åˆ†æ“ä½œæ˜¯æ»¤æ³¢å™¨ï¼ˆéœ€è¦é‚»åŸŸï¼‰
2. ç”¨æˆ·ç»å¸¸å¿˜è®°è¾¹ç•Œå¤„ç†
3. è¶Šç•Œè®¿é—®å¯¼è‡´å´©æºƒæˆ–UB

**ä¸‹é‡‡æ ·çš„ç‰¹æ®Šæ€§**ï¼š
- ä¸å±äºä¼ ç»Ÿ"é‚»åŸŸæ“ä½œ"
- é‡‡æ ·åŒºåŸŸè‡ªç„¶åœ¨è¾¹ç•Œå†…
- æ–‡æ¡£è­¦å‘Šä¸é€‚ç”¨

### 8. ä»£ç å®¡æŸ¥å»ºè®®

#### 8.1 å½“å‰å®ç°è¯„ä¼°

**å½“å‰ä»£ç çš„è¾¹ç•Œä¿æŠ¤**ï¼š
```cpp
// âœ… å·²æœ‰çš„ä¿æŠ¤æªæ–½ï¼ˆè™½ç„¶ç†è®ºä¸Šä¸éœ€è¦ï¼Œä½†æä¾›äº†å®‰å…¨æ€§ï¼‰

// 1. æ•´æ•°è¾¹ç•Œè£å‰ª
xMinInt = max(xMinInt, oSrcRectROI.x);
xMaxInt = min(xMaxInt, oSrcRectROI.x + oSrcRectROI.width);

// 2. è¾¹ç¼˜åƒç´ è®¿é—®æ£€æŸ¥
if (wxMin > 0.0f && xMinInt > oSrcRectROI.x) { ... }

// 3. å³è¾¹ç¼˜æ£€æŸ¥
if (wxMax > 0.0f && xMaxInt < oSrcRectROI.x + oSrcRectROI.width) { ... }
```

**è¯„ä»·**ï¼šâœ“ é˜²å¾¡æ€§ç¼–ç¨‹ï¼Œè™½ç„¶æ•°å­¦ä¸Šä¸éœ€è¦ï¼Œä½†æä¾›äº†é¢å¤–å®‰å…¨ä¿éšœ

#### 8.2 æ˜¯å¦éœ€è¦ç§»é™¤è¾¹ç•Œæ£€æŸ¥ï¼Ÿ

**å»ºè®®ï¼šä¿ç•™è¾¹ç•Œæ£€æŸ¥**

åŸå› ï¼š
1. âœ… **å®‰å…¨æ€§**ï¼šé˜²æ­¢æµ®ç‚¹è¯¯å·®å¯¼è‡´çš„æ„å¤–è¶Šç•Œ
2. âœ… **é²æ£’æ€§**ï¼šå¤„ç†å¼‚å¸¸è¾“å…¥ï¼ˆå¦‚ç©ºROIï¼‰
3. âœ… **ä»£ç æ¸…æ™°åº¦**ï¼šæ˜ç¡®è¡¨è¾¾è¾¹ç•Œæ„è¯†
4. âœ… **æ€§èƒ½å½±å“æå°**ï¼šåˆ†æ”¯é¢„æµ‹å‹å¥½
5. âœ… **ç¬¦åˆNPPé£æ ¼**ï¼šé˜²å¾¡æ€§ç¼–ç¨‹

**ä¸å»ºè®®ç§»é™¤çš„åŸå› **ï¼š
- æµ®ç‚¹è¿ç®—å¯èƒ½æœ‰å¾®å°è¯¯å·®
- å¼‚å¸¸å‚æ•°å¯èƒ½å¯¼è‡´æ„å¤–
- ä¿æŒä¸NPPå…¶ä»–å‡½æ•°ä¸€è‡´çš„å®‰å…¨æ€§

### 9. æµ‹è¯•å»ºè®®

#### 9.1 è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹

è™½ç„¶ç†è®ºä¸Šä¸éœ€è¦borderï¼Œä½†åº”æµ‹è¯•ï¼š

```cpp
TEST(SuperSampling, BoundaryPixelsAreValid) {
    // ç¡®ä¿è¾¹ç¼˜åƒç´ çš„é‡‡æ ·ä¸è¶Šç•Œ

    int srcWidth = 100, srcHeight = 100;
    int dstWidth = 10, dstHeight = 10;

    // æµ‹è¯•æ‰€æœ‰ç›®æ ‡åƒç´ çš„é‡‡æ ·åŒºåŸŸ
    float scaleX = (float)srcWidth / dstWidth;
    float scaleY = (float)srcHeight / dstHeight;

    for (int dy = 0; dy < dstHeight; dy++) {
        for (int dx = 0; dx < dstWidth; dx++) {
            float centerX = (dx + 0.5f) * scaleX;
            float centerY = (dy + 0.5f) * scaleY;

            float xMin = centerX - scaleX/2;
            float xMax = centerX + scaleX/2;
            float yMin = centerY - scaleY/2;
            float yMax = centerY + scaleY/2;

            // éªŒè¯è¾¹ç•Œ
            EXPECT_GE(xMin, 0.0f);
            EXPECT_LE(xMax, srcWidth);
            EXPECT_GE(yMin, 0.0f);
            EXPECT_LE(yMax, srcHeight);
        }
    }
}
```

#### 9.2 ROIè¾¹ç•Œæµ‹è¯•

```cpp
TEST(SuperSampling, ROIBoundaryIsRespected) {
    // æµ‹è¯•ROIå†…çš„ä¸‹é‡‡æ ·

    NppiRect srcROI = {50, 50, 200, 200};  // ROIä»(50,50)å¼€å§‹
    NppiRect dstROI = {0, 0, 100, 100};

    // æ‰§è¡Œä¸‹é‡‡æ ·
    performResize(...);

    // éªŒè¯ï¼šä¸ä¼šè®¿é—®ROIå¤–çš„åƒç´ 
    // ï¼ˆé€šè¿‡å†…å­˜æ£€æŸ¥å·¥å…·éªŒè¯ï¼‰
}
```

## 10. æœ€ç»ˆç»“è®º

### 10.1 ç›´æ¥ç­”æ¡ˆ

**è¶…é‡‡æ ·ï¼ˆä¸‹é‡‡æ ·box filterï¼‰ä¸éœ€è¦borderæ‰©å±•ã€‚**

ç†ç”±ï¼š
1. âœ… é‡‡æ ·åŒºåŸŸæ•°å­¦ä¸Šä¿è¯åœ¨è¾¹ç•Œå†…
2. âœ… è¾“å‡ºå°ºå¯¸ < è¾“å…¥å°ºå¯¸ï¼ˆä¸‹é‡‡æ ·æ€§è´¨ï¼‰
3. âœ… ä¸éœ€è¦borderçš„æ“ä½œæœ‰æœ¬è´¨åŒºåˆ«
4. âœ… å½“å‰å®ç°å·²æœ‰è¾¹ç•Œæ£€æŸ¥ï¼ˆé˜²å¾¡æ€§ï¼‰
5. âœ… æµ‹è¯•éªŒè¯è¾¹ç•Œæƒ…å†µæ­£ç¡®

### 10.2 ä¸NPPæ–‡æ¡£çš„å…³ç³»

NPPæ–‡æ¡£çš„è­¦å‘Š**é€‚ç”¨äº**ï¼š
- âœ“ å›ºå®šæ ¸å·ç§¯ï¼ˆ3Ã—3, 5Ã—5ç­‰ï¼‰
- âœ“ å½¢æ€å­¦æ“ä½œ
- âœ“ è¾¹ç¼˜æ£€æµ‹
- âœ“ ä¸Šé‡‡æ ·æ’å€¼

NPPæ–‡æ¡£çš„è­¦å‘Š**ä¸é€‚ç”¨äº**ï¼š
- âœ— ä¸‹é‡‡æ ·ï¼ˆåŒ…æ‹¬è¶…é‡‡æ ·ï¼‰
- âœ— ç‚¹æ“ä½œ
- âœ— ROIè£å‰ª

### 10.3 å®è·µå»ºè®®

1. **ä¸éœ€è¦nppiCopyConstBorderç­‰**ï¼š
   ```cpp
   // âœ— ä¸éœ€è¦
   // nppiCopyConstBorder(...);  // ä¸‹é‡‡æ ·ä¸éœ€è¦
   nppiResize(..., NPPI_INTER_SUPER);
   ```

2. **ä¿ç•™è¾¹ç•Œæ£€æŸ¥ä»£ç **ï¼š
   - å½“å‰å®ç°çš„è¾¹ç•Œæ£€æŸ¥æ˜¯å¥½çš„é˜²å¾¡æ€§ç¼–ç¨‹
   - æä¾›é¢å¤–å®‰å…¨ä¿éšœ
   - æ€§èƒ½å½±å“å¯å¿½ç•¥

3. **æ–‡æ¡£è¯´æ˜**ï¼š
   - åœ¨ä»£ç æ³¨é‡Šä¸­è¯´æ˜ä¸‹é‡‡æ ·ä¸éœ€è¦border
   - è§£é‡Šä¸ä¼ ç»Ÿé‚»åŸŸæ“ä½œçš„åŒºåˆ«
   - è®°å½•è¾¹ç•Œæ£€æŸ¥çš„é˜²å¾¡æ€§ç›®çš„

### 10.4 ä»£ç æ³¨é‡Šå»ºè®®

```cpp
// Super sampling V2 interpolation (weighted box filter, based on kunzmi/mpp)
//
// Note: Unlike fixed-kernel neighborhood operations (e.g., 3Ã—3 box filter),
// super sampling for downsampling does NOT require border expansion because:
// 1. Output size < input size (downsampling property)
// 2. Sampling regions naturally fit within input boundaries
// 3. Each output pixel samples from: [center - scale/2, center + scale/2)
//    which is guaranteed to be within [0, srcSize) for valid dst coordinates
//
// The boundary checks below are defensive programming to handle edge cases
// and floating-point rounding, not fundamental requirements.
template <typename T, int CHANNELS>
struct SuperSamplingV2Interpolator {
    // ...
};
```

---

## å‚è€ƒèµ„æ–™

1. NPP Documentation: "Sampling Beyond Image Boundaries"
2. å½“å‰å®ç°: `src/nppi/nppi_geometry_transforms/interpolators/super_v2_interpolator.cuh`
3. è¾¹ç•Œæµ‹è¯•: `test/unit/nppi/nppi_geometry_transforms/test_nppi_resize.cpp`
4. æ•°å­¦è¯æ˜: æœ¬æ–‡æ¡£ Section 2.2
